//Copyright (c) 2013 Rice University
// This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
// See LICENSE.txt for details.

// TEST: To test this file run:
//
// 1. `lessc ccap-base.less > ccap-base.css`
// 2. `lessc refactor-ccap-base.less | diff -w ccap-base.css -`


// FIXME: Replace this with ccap-css3.less
@import url('ccap-css3.css');
@import url('refactor/utils.less');


// Define variables
@stix-fonts: STIXGeneral, STIXSizeOneSym, STIXSize1;
@font-family: Liberation Sans, sans-serif, @stix-fonts;


// Utilities defined in this file for some reason
.x-page-float(@float: bottom) { #utils>.page-float(@float); }
.x-column-count(@num: 2)      { #utils>.column-count(@num); }


/***************************************************
 * Book Table of Contents
 ***************************************************/

@import url('refactor/base-toc.less');
@import url('refactor/skeleton-toc.less');


// *************************************************
// * Default Styles for Parts
// *************************************************

@import url('refactor/base-part.less');

/***************************************************
 * PREFACE
 ***************************************************/
.preface {
  > .titlepage {
    h1.title { #part>#title>.style(preface); }
  }

  > .section  {
    h2 {
      font-size: medium;
      > .cnx-gentext-t::before { display: none; } //hide pipe delimiter before section title
    }

    h3 {
      font-weight: bold;
      font-size: small;
    }
  }

  //preface: table without separators: hide table caption and table border
  .table {
    caption { display: none; }
    table { border-bottom: none !important; }  //override book specific rule
  }

  .figure > .title { display: none; } //preface: hide figure title

  ul > li { list-style-type: none; }
}


/***************************************************
 * CHAPTER INTRODUCTION
 ***************************************************/
 // titlepage: introduction banner - used for page headers
h1.title { //ccap-chapter
  #part>#title>.style(default);

  .cnx-gentext-autogenerated { display: none; } //The 1st span contains the chapter number

  .cnx-gentext-n { //ccap-chapter-number
    #part>#title>.number(default);
  }
}

.chapter  > .introduction {

  // hide manual key concepts table
  table.simplelist { display: none; }

  > .title { //.ccap-intro-title
    #part>#introduction>.title(chapter);
  }

  .splash {
    img {
      #part>#introduction>#splash-figure>.image(chapter);
    }
  }

  > .toc {
    #part>#toc>.style();

    > .title {
      #part>#toc>.title-content();
      #part>#toc>.title();
    }

    > * {
      #part>#toc>.children();
      > li {
        #part>#toc>#entry>.style();
      }
    }

    // TODO: Delete me. this is the same as #part>#toc>.children()
    > ul {
      padding-left: 0em;
      margin-left: 1em;
    }

    a {
      #part>#toc>#entry>.title();
    }
    .toc-section {
      .abstract { display: none; } //hide section-level abstract from objectives
      .cnx-gentext-autogenerated { display: none; }
      .cnx-gentext-t { #part>#toc>#entry>.children-indent(); }
      .cnx-gentext-n {
        &::after { #part>#toc>#entry>.d-section-colon(); } //add : after section #
        }
    }
    .abstract {
      #part>#toc>#entry>#abstract>.style();
      #part>#toc>#entry>#abstract>.content-style();
    }
  }
}


/* ********************* Stopped Refactoring Here ********** */

/***************************************************
 * SECTION LEVEL LEARNING OBJECTIVES (section abstract)
 ***************************************************/
.section > .titlepage {
  .abstract {
    margin: 1em 0em;
    padding: .50em;
    page-break-inside: avoid;
    page-break-before: avoid;

    ul > li { margin: .25em 0em; }
  }
}


/* Squirrel away the collection URL so it shows up as the footer on every page */
#title_page_url a[href] {
  prince-text-replace: ":9680" "";  //this strips the port number
  string-set: cnx-collection-url attr(href);
}

/* Don't print module asterix (link to attribution) */
.section .titlepage, .introduction > .title, .appendix .titlepage {
  sup a { display: none; }
}

/* Hide the TOC for the Appendix */
.appendix .toc { display: none; }

/* Footnotes. remove margins */
.footnote {
  text-align: left;
  margin-top: 0em;
  margin-bottom: 0em;
  padding-top: 0em;
  padding-bottom: 0em;
  * {
    margin-top: 0em;
    margin-bottom: 0em;
    padding-top: 0em;
    padding-bottom: 0em;
  }
}

/********************** Generic Elements ********************/
body {
  font-size: 8.2pt;
  font-family: @font-family;
}

// BUGFIX: In princexml SVG in a table heading doesn't use the fonts set in the SVG
/* This NEEDS to be on its own line (can't do "body, th * { ...") */
th * { font-family: @font-family; }

a[href^="http"] { content: content() " (" attr(href) ") "; }

.chapter, .appendix, .colophon {
  page-break-before: right;
  page-break-after: left;
}

.equation {
  page-break-inside: avoid;
  text-align: center;
  display: block;
}
.equation .label { float: right; }

.figure {
  font-size: xx-small;
  padding-bottom: 0.5em;
  margin-left: auto;
  margin-right: auto;
  page-break-inside: avoid;
  column-break-inside: avoid;
}

.mathml-mi { font-family: Liberation Serif, serif, STIXGeneral, STIXSizeOneSym, STIXSize1; }

/**************************** Index **************************/
.book > .index {
  page-break-before: always;
  page-break-after: always;
  page-break-inside: auto;
  string-set: cnx-header "Index";
  .x-column-count(3);
}

.index .title * {
  display: inline;
  string-set: cnx-header content();
}

.index .letter { font-weight: bold; }

.indexdiv, .indexdiv dl { page-break-inside: auto; }

.indexterm[href] { content: target-counter(attr(href), page); }


/********************* Glossary Section **************/
#book.attribution, .colophon { font-size: x-small; }


/**************** Fix the PDF Outline *************/
h1 { bookmark-level: 1; page-break-after: avoid; }
h2 { bookmark-level: 2; page-break-after: avoid; }
h3, h4, h5, h6 { bookmark-level: none; page-break-after: avoid; }


/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/
li p, dd p {
  margin-top: 0px;
  margin-bottom: 0px;
}

ol, ul { margin-top: 0px; }

dl { margin: 0.5em; }

// TODO: This needs to be removed as it produces three levels of settings
// for paragraph leading. Our indentation mixin, the default prince style and this
// Need to reduce to just one override, our mixin overridding prince default style
p { margin: 0.5em 0em; }

.table {
  page-break-inside: avoid;
  margin: auto;
}

.table td { padding: 0.25em; }

.table caption {
  align: top;
  text-align: left;
}

//Reset the table caption because I was dumb and didn't wrap the Table title in a span
div.table-caption {
  &.caption { display: inline; }
  font-weight: normal;
  color: black;
  display: inline;
  margin-left: 0.5em;
}

.itemizedlist .title {
  margin: 0px;
  float: none;
  max-width: inherit;
}


/***************************************************************
 * Styles originally from physics but used in Sociology
 ***************************************************************/

/***************** Title page *****************/

.book > .cnx-title h1 {
  text-align: center;
  font-size: xx-large;
  margin-top: 10em;
}

.cnx-title a, #book-attribution a { content: content(); }

a { text-decoration: none; }

.problems-exercises img {
  max-width: 3in;
  height: auto;
}

/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/
ol, ul { margin-left: 20pt; }

h2, h3, h4 { margin: 1em 0em 0em 0em; }

h2 { font-size: medium; }

h3 {
  font-size: 1.17em;
  font-weight: normal;
}

h4, h5, h6 { font-size: 1em; }

.table table { margin: 1.5em auto; }

.table th {
  color: white;
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 1em;
  padding-right: 1em;
  /* To fully support row/col spans in CALS tables borders are calculated for each cell and inherit the color of the text in the cell */
  /* By default the color in the PDF is the same color as the text so set it to black. */
  border-color: black !important;
}

div.table-caption.caption {
  caption-side: top;
  font-weight: bold;
}


/**************** CNXML ELements ***********/
.note { //.ccap-note
  /* page-break-inside: avoid; Per David's request, less whitespace is better. */
  padding-left: 1em;
  padding-right: 1em;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

.note h3 { margin-top: 0.5em; }

.note > .title { page-break-after: avoid; }

.exercise {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

.example {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
.figure {
  font-size: xx-small;
  padding-bottom: 0.5em;
  margin-left: auto;
  margin-right: auto;
}
.figure > .caption:before,
.figure > .title {
  display: inline;
  margin-bottom: 0.25em;
  margin-top: 0.25em;
}

.figure > .caption { display: inline; }

.figure > .body { text-align: center; }


/************** Generic Elements ************/
/* center the table */
table.cnx-figure-horizontal { margin: auto; }

table.cnx-figure-horizontal td img { max-width: 2in; }

table.cnx-figure-horizontal td img[height] { height: auto; }

img[height] { width: auto; }

img { max-width: 7in; }


/********************* Glossary Section **************/

.glossary dt {
  float: left;
  font-weight: bold;

  &::after {
    content: ":";
    padding-right: 0.5em;
    display: inline !important; //Important because the pseudo's are hidden by default in a glossary
  }
}

em.glossterm {
  font-weight: bold;
  font-style: normal;
}


/******************************************************
 * End of chapter customizations
 ******************************************************/
.cnx-eoc {
  & > .title {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
  .section {
    .title {
      padding-top: 1em;

      a {
        //color: @blue;
        font-size: small;
        font-weight: bold;
      }
    }

    .problem {
      page-break-inside: avoid;
    }
  }
}

.example > .title > *,
.cnx-eoc > .title > *,
.index > .title > *,
.glossary > .titlepage > div > div > * {
  //.ccap-block-title;
  //.ccap-block-title-link;
  padding: .1em 1em;
  margin-top: 1em;
  display: inline;

  font-size: small;
  font-weight: bold;
  page-break-after: avoid;
}


/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * End-of-chapter exercises require a LOT of custom formatting
 * Moving from Docbook will fix this
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/* Exercises have the number in bold, followed by the 1st paragraph inline, not "Exercise 3 \n sldkfj" */

.cnx-eoc .exercise {

  /*** Exercises normally have more margins around them ***/
  margin-top: 0.5em;
  margin-bottom: 0.0em;

  div, p:first-of-type {
    display: initial;
  }

  div .figure {
    .body {
      display: block;
      text-align: center;
    }
    .title {
      //display: none;
    }
  }

  /* Hide the "Exercise " prefix */
  & > .title .cnx-gentext-autogenerated {
    display: none;
  }
  & > .title .cnx-gentext-n {
    font-weight: bold;
    font-size: 8.2pt;
    color: black;
  }
  & > .title {
    border-bottom: 0px;
  }

  /*** Make sure the default background colors for things like exercise body don't seep through ***/
  p, .body {
    background-color: inherit !important;
    padding: 0px !important;
  }


  .solution {
    display: none;
  }

  .problem > .title {
    font-weight: bold;
    margin-right: 0.5em;
  }

}

.exercise .solution::before {
  content: "Solution";
  font-weight: bold;
  display: block;
}


/***************************************************
 * Indentation
 ***************************************************/
.cnx-indentation(@indent: 0) {
  text-indent: @indent;
  margin-bottom: .5em; //Leading between paragraphs
}

.cnx-indentation-base() {
  p,
  p:nth-of-type(1),
  p:nth-of-type(2),
  .note p,
  .notes p,
  .references p,
  .cnx-eoc p,
  .body p {
    .cnx-indentation;
  }
}


.cnx-indentation-base;
