/*******************************************************
* Copyright (c) 2013 Rice University
*  This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
*  See LICENSE.txt for details.
*******************************************************/

 /* Styles used when generating a PDF from xhtml+css
 ***************************************************/

// Import general page headers/footers, bookmark calculation, etc
@import url('ccap-base.less');
@import url('ccap-numbering.less');

// Import derived base book for override
@import url('ccap-precalculus.less');

// Import for page-breaking debugger
@import url('debug-page-break.less');

// Color palette for economics
@dark-blue:     #3767B1;
@medium-blue:   #83C6EE;
@light-blue:    #CFE1F1; 
@gray:          #EFEFEF;  


// A mixture of serif and sans-serif fonts.
@font-family-serif: Liberation Serif, serif, @stix-fonts;

@page-width: 6.5in;
@page { margin: 0.5in 1in; }
// Finished printed size of the QR code is dependent on: 1-distance between qr code and scanning device
// 2-size of dots in the code(amount of data inputed into the code, the smaller the dots become)
// For most smartphones the relationship between scan distance and minimum QR code size is approximately 10:1 so a 2.5cm (1 inch)
@qr: 1.25in;

// Images in Economics are 120DPI
html {
  prince-image-resolution: 120dpi;
}

/******************************************************
 * Economics Custom elements
 *
 * Most of the customizations are
 * `.note` elements with specific classes
 *
 ******************************************************/


/* -------------------------
 * Note Features for Text
 * -------------------------
 */

.note {
  &.economics {
    // Bring It Home Feature
    &.bringhome {
      .x-pb-inside(auto);
      .x-feature(black, @gray, bring, 0.48in); 
    }
    // Clear It Up Feature
    &.clearup {
      .x-pb-inside(auto);
      .x-feature(black, @gray, clear, 0.53in); 
    }
    // Work It Out Feature
    &.workout {
      .x-pb-inside(auto);
      .x-feature(black, @gray, work, 0.38in); 

      // Supress the extra url generated from base that is wrapped with parentheses
      .itemizedlist > .listitem .link.only-show-once { 
        content: content();
      }
    }
    // Link It Up Feature
    &.linkup {
      .x-pb-inside(auto);
      .x-feature(black, @gray, link, 0.38in); 

      img {   //center qr code
        display: block;
        margin: auto;
      }

      .link { 
        color: @dark-blue;
        font-weight: normal;
      }
    }
    // Manual Chapter Objectives Note Utilized as Introduction Header as well in Economics
    &.chapter-objectives {
      // We must use a background color here to stop Precalculus from assuming this is
      // a generic precalculus note and giving it blue background.
      background-color: white;
      padding: 0;
      margin: 0;

      > .title {
        font-size: x-large;
        color: @dark-blue;
        // Border must be removed from title due to Precalculus thinking this is generic
        // note.  Since manual chapter objectives must be a note, we must keep Precalc at bay.
        border: none;
        padding-left: 0;
      }
    }
  }
}
 // End of .economics notes

/* -------------------------
 * Legacy .x-feature function from Anatomy text used due to identical features parameterization
 * -------------------------
 */

.x-feature (@color, @bg-color, @svg, @padding-top) {
  color: @color;
  font-family: @font-family;

  p:nth-of-type(2) {
    .x-pb-before(avoid);
  }
  &::before {
    padding-top: @padding-top; //from the SVG files
    background-repeat: no-repeat;
    .x-pb-after(avoid);
    background-color: white;
    content: "";
    display: block;
    // the following are tweaked so the overlays really do over lay
    margin-left: -1em;
    margin-right: -1em;
    margin-top: -0.05in;
  }

  background-color: @bg-color;
  &::before { background-image: url("ccap-economics/@{svg}.svg"); }

  > .title {
    font-size: large;
    margin-top: .6em;
    margin-bottom: .2em;
    padding: 0px .5em;
    color: black;
    border: none;
  }  

  // Must apply padding to all elements in body not just blockquote and para, tables 
  // are being stuffed inside features as well and must play nice with text alignment
  > .body { 
    padding: 0px .8em;

    // W&N requests that all inline elements inside feature be sans-serif
    p, ol, li { font-family: @font-family; }
  }

  .figure {
    img { max-width: (@page-width - .25em); }   
    > .title { font-size: 9.5pt; color: @dark-blue; }
  }
}


/* -------------------------
 * Preface
 * -------------------------
 */
.preface {
  > .titlepage {
    h1.title { background-color: @dark-blue; }
  }

  // Contributors and Reviewers in book are created with tables.  We must turn off
  // the borders for these in the preface. !important must be used here to override
  // the border that was used with !important in general table styling.  All of this
  // goes away when economics gets skeletonized. 
  .table table {
    border: none !important;
  }
}

/* -------------------------
 * Book Table of Contents
 * -------------------------
 */

 // A few styling rules from the inherited precalculus skeleton/slot is causing our toc to display
 // as the chapter outline.  This is coming from #part>#toc>#style in precalculus slots which have
 // been styled as the chapter outline, not the toc.  For now, for expediency, fixing here so
 // refactor files are not changed and the possible introduction of more regressions.
.book > .toc {
  border: none;
  > .title {
    border-bottom-color: @dark-blue;
    color: @dark-blue;
    content: "Table of Contents";
    background: none;
    margin-bottom: .5em;
  }

  a { color: @dark-blue; }
}

/* ----------------------------------------------
 * Chapter Introduction & Learning Objectives
 * ----------------------------------------------
 */

// We can turn off the autogenerated title and utilize chapter-objectives note class
// to stand in as Introduction header to allow specialized content above header
.chapter > .introduction > .title { display: none; }

/*
  For Chapter Introduction and Learning Objectives there is a possible decision
  to use the default Chapter Outline box that aggregates module numbers and titles
  and forgo the use of the manual chapter objectives box that we have currently.
  Also, section level learning objectives might be used.  In both cases intial code
  has been added below to create these if needed.
*/

/* -------------------------
 * Chapter Introduction
 * -------------------------
 */

/* Save this section in case the deciscion is to revert to aggregated modules in Chapter Outline
.chapter > .introduction {
  > .toc a {
    color: @dark-blue;
  }

  // Styling for Chapter Outline Box
  >.toc { 
    border: 2pt solid @dark-blue;
  
    > .title {
      content: "Chapter Outline"; //override content string from base
      background-color: @dark-blue;
      min-width: 5.40in;
    }
  }
}
*/

/* -------------------------
 * Section Level Learning Objectives
* -------------------------
*/

// Another higher specificity DOM selector coming from PreCalc is overriding the border: none;
// below.  Choosing this instead of !important  This below overrides .section > .titlepage .abstract
div.section > div.titlepage div.abstract { border: none; }

.section > .titlepage {
  .abstract {
    border: none;

    // The absolute only way to get this to respond. There are literally dozens of margin and padding
    // present in the cascade for this element. As a part of refactoring we are seriously going to have
    // to chunk these atomic elemnts into containers and control the margin and padding at 1 or 2 levels,
    // not inheriting them from 50 layers.
    margin: 0 !important;
    padding: 0 !important;

    // For Economics there is no blue header/background or border box. Just a simple list
    &::before {
      display: none;
    }

    // Learning objectives font for economics is in serif and doesn't have left indent like PreCalculus
    p { 
      font-family: @font-family-serif;
      // destroy margin shorthand from PreCalc and then reduce margin space on top per W&N
      margin: 0;
      margin-top: .2em; 
    }


    // Economics doesn't need a counter for modules to display like PreCalculus - turning off
    .itemizedlist > .listitem {

      // PreCalc uses display:block to remove bullets and utilize list as block with counters
      // For Economics we need just garden variety bullets for list.  
      display: list-item;
      list-style-type: disc;
      margin-top: 0;

      &::before {
        display: none;
      }

      // styling must be overriden in PreCalculus to compensate for numbering that has been turned off
      // Bulleted items must never display on second line of text, always first line of text. Do not
      // need any margins from PreCalc as well.
      p { 
        display: inline; 
        margin: 0; 
      }
    }
  }
}

/* -------------------------
 * Generic Elements
 * -------------------------
 */

// This high-specifity DOM value for the title is coming from PreCalc 
// and overriding our nice .chapter h1.title below.  It's either set it this
// way below to override or use !important on .chapter h1.title.  Anything
// but evil !important.  We will refactor this bit into skeleton or broom
// up DOM across books.
div.book div.chapter > div.titlepage > div > div h1.title {
  color: @dark-blue;
  > span.cnx-gentext-n {
    color: @dark-blue;
  }
}

// colors null and void due to above structure coming from PreCalc
.chapter h1.title {
  margin-top: 0;
  padding-top: 0;
  font-size: 34pt; 
  color: @dark-blue;
  text-transform: none; 
  
  // Chapter number
  .cnx-gentext-n {
    color: @dark-blue;
  }
}

h2, h3, h4, h5, h6 {
  color: @dark-blue;
}

// Module title
h2 {
  .cnx-gentext-n { color: @dark-blue; }

  &::before { color: @dark-blue; }
}

a { 
  font-family: @font-family;
  font-weight: bold; 
  color: @dark-blue;
}

p { font-family: @font-family-serif; }

// Higher specificity vaules comes from Precalculus require us to use
// .chapter and .introduction classes here as a wrapper. Cannot use just
// blockquote inline tag here anymore. 
.chapter, 
.introduction {
  blockquote {
    color: black;
    font-family: @font-family-serif;
    font-size: inherit;
    margin-top: inherit;
    margin-bottom: inherit;

    &::before, &::after {
      content: "";
    }
  }
}

/*----------------------
 * Misc Color changes
 *----------------------
 */

//These should just be replacing @color1 with @color2

.target-figure {
  font-family: @font-family;
  color: @dark-blue;
}

.target-table {
  font-family: @font-family;
  color: @dark-blue;
  font-weight: bold;
}



/* -------------------------
 * Tables
 * -------------------------
 */

.table table {
  width: 100%;
  border-left: 0 !important;
  border-right: 0 !important;
  border-top: 2px solid @dark-blue !important; // !important used to override inline-style...

  caption,
  caption span,
  caption::before {
    // font added here so down cascade table captions will render well inside eoc question sections
    font-family: @font-family;
    color: @dark-blue;
    padding-bottom: 0;
  }

  // table numbering/caption must be dark blue, but any associated caption should be black;
  caption span.table-caption.caption { color: black; }

  thead {
    th {
      // font designation added so down the cascade tables in self-check questions, and other eoc sections will be sans-serif headings
      font-family: @font-family;
      // autogenerated inline styles are laced with !important, so for economics
      // design we need no right border on table head and also text centered.
      border-right: 0 !important;
      text-align: center !important;

      background-color: @light-blue;
      border-bottom: 2px solid @dark-blue !important; //!important used in ccap-precalculus.
    }
  }

  // Reduce padding inside table cells in this godforsaken land of !important
  tbody {
    tr td { padding: 5px; }
  }

  // Format and style lists there are being used inside tables
  .itemizedlist {
    list-style-type: disc;
    margin-top: .5em;
    margin-left: 1em;
  }
}



/* -------------------------
 * Figure/Subfigures
 * -------------------------
 */


.figure {
  font-family: @font-family;
  font-size: 9.5pt;

  > .title { color: @dark-blue; }
}



/* -------------------------
 * Chapter Introduction
 * -------------------------
 */
.chapter > .introduction {
  > .toc a {
    color: @dark-blue;
  }

/******************************************************************************
 * Styling for Chapter Outline Box
 ******************************************************************************/

  >.toc { 
   display: none; 
  }
}


/******************************************************************************
 * EOC Styling
 ******************************************************************************/

 // Key Terms
.glossary {
  > .titlepage h2.title {
    font: normal normal 700 13pt/1em @font-family;
    color: @dark-blue;
    padding-left: 0;
  }

  &:before {
    display: none !important; // !important is used in ccap-precalculus.
  }
}

.glossterm.no-emphasis {
  font-weight: 400;
}

// Stop indentation of Key terms and force adherence to 6.5in page width - avoidance of CSS shorthand
.glossary > dl { 
  margin-left: 0;
  margin-right: 0;
  margin-top: .5em;
  margin-bottom: .5em;
}

// Remove pesky : colon after Key Term
.glossary dl dt:after {
    content: " ";
}

// In base-skeleton.less some former precalculus universal selector cruft from precalcuus
// exists. We have to target the span here to fix the header sizes and remove a little padding
// to comply with economics template.
.cnx-eoc > .title > span {
  padding-left: 0;
  font-size: 13pt;
}

// All numbered exercises must have much smaller margins at bottom (Not 1.5em coming from PreCalc)
.cnx-eoc .exercise { margin-bottom: .5em; }

.cnx-eoc {
  &.summary,
  &.self-check-questions,
  &.review-questions,
  &.critical-thinking,
  &.problems {
    > .title {
      color: @dark-blue !important; // !important used in ccap-precalculus.
      font-size: 13pt;
    }
    > .section > .title > a {
      color: @dark-blue;
    }
  }
}
.cnx-eoc {
  > .title {
    font: normal normal 700 13pt/1em @font-family;
  }
  > .section {
    > .title {
      font: normal normal 700 13pt/1em @font-family;
    }
    > .body {
      font: normal normal 400 10pt/12pt @font-family-serif;
    }
  }
}
.cnx-eoc {
  .title {
    margin-top: 1em;
    column-span: all;
    padding-left: 0;
  }
  > .section > .title {
    display: none;
  }
  > .section.empty {
    display: none; // Get rid of extra spacing from padding
  }

// Key Concepts & Summary
  &.summary {
    > .title {
      content: "Key Concepts and Summary";
      text-transform: uppercase;
      margin-bottom: 0;
    }

    > .section > .title {
      display: block;
      padding-top: 0;
    }

    p:nth-of-type(1) {
      margin-top: .5em;
    }
  }

// Self-Check Questions
  &.self-check-questions {
    column-count: 1;
  }
// Review Questions

// Critical Thinking Questions

// Problems

// Hide EOC Solutions
  &.cnx-solutions {
    display: none;
  }
// Hide EOC References
  &.references {
    display: none;
  }
}

/******************************************************************************
 * EOB Styling
 ******************************************************************************/

// This equation block below comes from PreCalculus which required equation numbering
// in it's design. Just changing color from orange (precalc) to @dark-blue for 
// aesthetics until we hear from W&N whether or not they want equation numbering
// in Economics.  If not, we can turn off the numbering below.

/* ---------------------------------------------------
 * Equations
 * ---------------------------------------------------
 */
// Turn off equation hiding for pre-calculus text
div.book,
div.book > div.part {
  > div.preface,
  > div.chapter,
  > div.appendix {
    > div.section div.equation > *:last-child::after {
      display: none;
    }
  }
}

// Key Terms section counter adjustment. From Precalculus
// remove (-1) designation to make sure reset begins at 1.1 instead of 1.0
.x-duplicate-hierarchy() {
  > div.cnx-eoc { counter-reset: /*exercise*/ eoc-section; }
 }

div.book, div.book > div.part {
  > div.preface  { .x-duplicate-hierarchy(); }
  > div.chapter  { .x-duplicate-hierarchy(); }
  > div.appendix { .x-duplicate-hierarchy(); }
} 

// Attributions & About Connexions Header need to be dark blue for economics
.colophon > h1.title {
  color: @dark-blue;
}

// References
div.colophon.end-of-book-references .chapter-area {
  // Indentation of second line of reference requested by W&N along with no full justification on items
  .body .section-area {
    p {
      text-align: left;
      padding-left: 1.5em; 
      text-indent: -1.5em;
    }
  }

  .body .section-area .title {
    display: none; // Do not display section titles.
  }

  > .title {
    color: black;
  }
}


// Answer Key 
div.colophon.end-of-book-solutions {
  > .title { 
    color: @dark-blue; 
    margin-left: 0;
  }

  div.chapter-area {

    // Decrease margin fluff coming from other books. Other overrides and higher
    // specificity elements are adding too much space.
    > .title {
      margin-bottom: 0;
    }

    // Remove period after Chapter headers in Answer Key
    a:after {
      content: "";
    }
    
    div.solution {
      padding-bottom: .5em;

      // Answers must be in line with number
      > div.title { 
        display: inline;
      }

      > div.title a.solution {
        padding-right: .2em;  
        
        // Solution in Answer Key needs to have period after number.
        &::after {
          content: ". ";
        }
      }

      &:nth-of-type(1) {
        padding-top: .5em;
      }

      > div.body {
        display: inline;
        position: relative;

        // lists must not be inline 
        li { display: list-item; }

        
        .equation {
          // Equations need to be on their own line.  We must override inline style for equations.
          display: block;
          // Equation numbering turned off in Appendix/Answer Key.  There is no default setting/code
          // in numbering.less that turns off equation numbering by default for all sections of book.
          // We will need to extract this part later so we turn off equation numbering for all books.
          > span.label { display: none; }
        }

        /*
        * This is a bug-fix related to 
        *    display: inline;
        *    * { display: inline; }
        * being used in ccap-precalculus.less.
        */

        .table,
        table {
          display: table;
          caption { display: table-caption; }
          thead { display: table-header-group; }
          tbody { display: table-row-group; }
          tr { display: table-row; }
          td, th { display: table-cell; }
        }

        // Since up till now Answer Key has been just a blob of inline text, we must some how undo
        // the multitude of display:inline to allow the myriad new elements that are now a part of Answer Key.
        // Figures must be converted to block level elements and then
        // styled accordingly
        .figure { 
          // Stop outer container from collapsing
          display: block;
          margin-top: 1em;

          // Figures are not to be numbered for Answer Key so associated caption/title are not displayed
          .title {
            display: none;
          }

          & img {
            // For figure imagery in Answer Key we need to center figures
            display: block;
            margin: 0 auto;
          }
        }
      }    
    }
  }
}




/******************************************************
 * Appendix 
 ******************************************************/
.appendix {

  h1.title {
    color: @dark-blue;
    padding: 0;
  }

  // Style Appendix Alpha-numeric and place "Appendix" before it
  h1.title .cnx-gentext-n {
    font-size: 35pt;
    font-weight: bold;
    color: @dark-blue;
    text-transform: capitalize;

    &::before {
      content: "Appendix ";
    }
  }

  h1.title span.cnx-gentext-t {
    text-transform: capitalize;
    font-size: 35pt;
    font-weight: bold;
  }
}

//div.book > div.appendix > div.titlepage > div > div h1.title span.cnx-gentext-t

// Since these appendices have been created with subsections we must stop
// the counter from showing and the pipe text decoration (|) per W&N design
.appendix .section > .titlepage h2::before,
.appendix .section > .titlepage h2 .cnx-gentext-t:before { 
  display: none;
}

div.index div.title h2 {
  color: @dark-blue;
}