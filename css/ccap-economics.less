/*******************************************************
* Copyright (c) 2013 Rice University
*  This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
*  See LICENSE.txt for details.
*******************************************************/

 /* Styles used when generating a PDF from xhtml+css
 ***************************************************/

// Import general page headers/footers, bookmark calculation, etc
@import url('ccap-base.less');
@import url('ccap-numbering.less');

// Import derived base book for override
@import url('ccap-precalculus.less');

// Import for page-breaking debugger
@import url('debug-page-break.less');

// Color palette for economics
@dark-blue:     #3767B1;
@medium-blue:   #83C6EE;
@light-blue:    #CFE1F1; 
@gray:          #EFEFEF;  

// A mixture of serif and sans-serif fonts.
@font-family-serif: Liberation Serif, serif, @stix-fonts;

@page-width: 6.5in;
@page { margin: 0.5in 1in; }
// Finished printed size of the QR code is dependent on: 1-distance between qr code and scanning device
// 2-size of dots in the code(amount of data inputed into the code, the smaller the dots become)
// For most smartphones the relationship between scan distance and minimum QR code size is approximately 10:1 so a 2.5cm (1 inch)
@qr: 1.25in;


/******************************************************
 * Economics Custom elements
 *
 * Most of the customizations are
 * `.note` elements with specific classes
 *
 ******************************************************/


/* -------------------------
 * Note Features for Text
 * -------------------------
 */

.note {
  &.economics {
    // Bring It Home Feature
    &.bringhome {
      .x-pb-inside(auto);
      .x-feature(black, @gray, bring, 0.48in); 
    }
    // Clear It Up Feature
    &.clearup {
      .x-pb-inside(auto);
      .x-feature(black, @gray, clear, 0.53in); 
    }
    // Work It Out Feature
    &.workout {
      .x-pb-inside(auto);
      .x-feature(black, @gray, work, 0.38in); 

      // weblinks included in media list need to be orange and bold
      .itemizedlist > .listitem {
        color: @orange;
        font-weight: bold;
      }

      // Supress the extra url generated from base that is wrapped with parentheses
      .itemizedlist > .listitem .link.only-show-once { 
        content: content();
      }
    }
    // Link It Up Feature
    &.linkup {
      .x-pb-inside(auto);
      .x-feature(black, @gray, link, 0.38in); 

      img {   //center qr code
        display: block;
        margin: auto;
      }

      .link { 
        color: @dark-blue;
        font-weight: normal;
      }
    }
    // Manual Chapter Objectives Note Utilized as Introduction Header as well in Economics
    &.chapter-objectives {
      // We must use a background color here to stop Precalculus from assuming this is
      // a generic precalculus note and giving it blue background.
      background-color: white;
      padding: 0;
      margin: 0;

      > .title {
        font-size: x-large;
        color: @dark-blue;
        // Border must be removed from title due to Precalculus thinking this is generic
        // note.  Since manual chapter objectives must be a note, we must keep Precalc at bay.
        border: none;
        padding-left: 0;
      }
    }
  }
}
 // End of .economics notes

/* -------------------------
 * Legacy .x-feature function from Anatomy text used due to identical features parameterization
 * -------------------------
 */

.x-feature (@color, @bg-color, @svg, @padding-top) {
  color: @color;
  font-family: @font-family;

  p:nth-of-type(2) {
    .x-pb-before(avoid);
  }
  &::before {
    padding-top: @padding-top; //from the SVG files
    background-repeat: no-repeat;
    .x-pb-after(avoid);
    background-color: white;
    content: "";
    display: block;
    // the following are tweaked so the overlays really do over lay
    margin-left: -1em;
    margin-right: -1em;
    margin-top: -0.05in;
  }

  background-color: @bg-color;
  &::before { background-image: url("ccap-economics/@{svg}.svg"); }

  > .title {
    font-size: large;
    margin-top: .6em;
    margin-bottom: .2em;
    padding: 0px .4em;
    color: black;
    border: none;
  }  

  > .body p, blockquote { 
    font-family: @font-family; 
    padding: 0px .8em;
  }

  .figure {
    img { max-width: (@page-width - .25em); }   
    > .title { font-size: x-small; color: @dark-blue; }
  }
}




/* -------------------------
 * Preface
 * -------------------------
 */
.preface {
  > .titlepage {
    h1.title { background-color: @dark-blue; }
  }
}

/* -------------------------
 * Book Table of Contents
 * -------------------------
 */
.book > .toc {
  > .title {
    border-bottom-color: @dark-blue;
    color: @dark-blue;
  }

  a { color: @dark-blue; }
}

/* ----------------------------------------------
 * Chapter Introduction & Learning Objectives
 * ----------------------------------------------
 */

// We can turn off the autogenerated title and utilize chapter-objectives note class
// to stand in as Introduction header to allow specialized content above header
.chapter > .introduction > .title { display: none; }

/*
  For Chapter Introduction and Learning Objectives there is a possible decision
  to use the default Chapter Outline box that aggregates module numbers and titles
  and forgo the use of the manual chapter objectives box that we have currently.
  Also, section level learning objectives might be used.  In both cases intial code
  has been added below to create these if needed.
*/

/* -------------------------
 * Chapter Introduction
 * -------------------------
 */

/* Save this section in case the deciscion is to revert to aggregated modules in Chapter Outline
.chapter > .introduction {
  > .toc a {
    color: @dark-blue;
  }

  // Styling for Chapter Outline Box
  >.toc { 
    border: 2pt solid @dark-blue;
  
    > .title {
      content: "Chapter Outline"; //override content string from base
      background-color: @dark-blue;
      min-width: 5.40in;
    }
  }
}
*/

/* -------------------------
 * Section Level Learning Objectives
* -------------------------
*/

.section > .titlepage {
  .abstract {
    border: none;

    // For Economics there is no blue header/background or border box. Just a simple list
    &::before {
      display: none;
    }

    // Economics doesn't need a counter for modules to display like PreCalculus - turning off
    .itemizedlist > .listitem {

      // PreCalc uses display:block to remove bullets and utilize list as block with counters
      // For Economics we need just garden variety bullets for list.  
      display: list-item;
      list-style-type: disc;

      &::before {
        display: none;
      }
    }
  }
}



/* -------------------------
 * Generic Elements
 * -------------------------
 */

.chapter h1.title {
  margin-top: 0;
  padding-top: 0;
  font-size: 34pt; 
  color: @dark-blue;
  text-transform: none; 
  
  // Chapter number
  .cnx-gentext-n {
    color: @dark-blue;
  }
}

h2, h3, h4, h5, h6 {
  color: @dark-blue;
}

// Module title
h2 {
  .cnx-gentext-n { color: @dark-blue; }

  &::before { color: @dark-blue; }
}

a { 
  font-family: @font-family;
  font-weight: bold; 
  color: @dark-blue;
}

p { font-family: @font-family-serif; }

blockquote {
  color: black;
  font-family: @font-family-serif;
  font-size: inherit;
  margin-top: inherit;
  margin-bottom: inherit;

  &::before, &::after {
    content: "";
  }
}

/*----------------------
 * Misc Color changes
 *----------------------
 */

//These should just be replacing @color1 with @color2

.target-figure {
  font-family: @font-family;
  color: @dark-blue;
}

.target-table {
  font-family: @font-family;
  color: @dark-blue;
  font-weight: bold;
}



/* -------------------------
 * Tables
 * -------------------------
 */

.table table {
  width: 100%;
  border-left: 0 !important;
  border-right: 0 !important;
  border-top: 2px solid @dark-blue !important; // !important used to override inline-style...

  caption,
  caption span,
  caption::before,
  caption span.table-caption.caption {
    // font added here so down cascade table captions will render well inside eoc question sections
    font-family: @font-family;
    color: @dark-blue;
    padding-bottom: 0;
  }

  thead {
    th {
      // font designation added so down the cascade tables in self-check questions, and other eoc sections will be sans-serif headings
      font-family: @font-family;
      // autogenerated inline styles are laced with !important, so for economics
      // design we need no right border on table head and also text centered.
      border-right: 0 !important;
      text-align: center !important;

      background-color: @light-blue;
      border-bottom: 2px solid @dark-blue !important; //!important used in ccap-precalculus.
    }
  }
}



/* -------------------------
 * Figure/Subfigures
 * -------------------------
 */


.figure {
  border: 1px solid green;
  font-family: @font-family;
  font-size: 9.5pt;

  > .title { color: @dark-blue; }

  & img { border: 1px solid red; }
}



/* -------------------------
 * Chapter Introduction
 * -------------------------
 */
.chapter > .introduction {
  > .toc a {
    color: @dark-blue;
  }

/******************************************************************************
 * Styling for Chapter Outline Box
 ******************************************************************************/

  >.toc { 
   display: none; 
  }
}


/******************************************************************************
 * EOC Styling
 ******************************************************************************/

// Key Terms
.glossary > .titlepage h2.title {
  color: @dark-blue;
}
.glossary {
  > .titlepage h2.title {
    font: normal normal 700 13pt/1em @font-family;
  }

  > dl dt {
    font: normal normal 700 10pt/1em @font-family;
  }
  > dl dd {
    font: normal normal 400 10pt/1em @font-family-serif;
  }
}
.glossary {
  // Hide "Chapter x Review" title.
  > .titlepage h2.title::before {
    display: none !important; // !important is used in ccap-precalculus.
  }

  > dl {
    margin: 0;

    > dt, > dd {
      &:first-of-type {
        padding-top: 1em;
      }
      padding-top: .2em;
    }
  }
}

// Glossary Term and Non-bolded Glossary Term
.glossary .glossterm {
  font: normal normal 700 10pt/13pt @font-family-serif;
}

.glossterm.no-emphasis {
  font-weight: 400;
}

.cnx-eoc {
  &.summary,
  &.self-check-questions,
  &.review-questions,
  &.critical-thinking,
  &.problems {
    > .title {
      color: @dark-blue !important; // !important used in ccap-precalculus.
    }
    > .section > .title > a {
      color: @dark-blue;
    }
  }
}
.cnx-eoc {
  > .title {
    font: normal normal 700 13pt/1em @font-family;
  }
  > .section {
    > .title {
      font: normal normal 700 10pt/1em @font-family;
    }
    > .body {
      font: normal normal 400 10pt/12pt @font-family-serif;
    }
  }
}
.cnx-eoc {
  .title {
    margin-top: 1em;
    column-span: all;
  }
  > .section > .title {
    display: none;
  }
  > .section.empty {
    display: none; // Get rid of extra spacing from padding
  }

// Key Concepts & Summary
  &.summary {
    > .title {
      content: "Key Concepts and Summary";
      text-transform: uppercase;
      margin-bottom: 0;
    }

    > .section > .title {
      display: block;
      padding-top: 0;
    }

    p:nth-of-type(1) {
      margin-top: .5em;
    }
  }

// Self-Check Questions
  &.self-check-questions {
    column-count: 1;
  }
// Review Questions

// Critical Thinking Questions

// Problems

// Hide EOC Solutions
  &.cnx-solutions {
    display: none;
  }
// Hide EOC References
  &.references {
    display: none;
  }
}

/******************************************************************************
 * EOB Styling
 ******************************************************************************/

// This equation block below comes from PreCalculus which required equation numbering
// in it's design. Just changing color from orange (precalc) to @dark-blue for 
// aesthetics until we hear from W&N whether or not they want equation numbering
// in Economics.  If not, we can turn off the numbering below.

/* ---------------------------------------------------
 * Equations
 * ---------------------------------------------------
 */
// Turn off equation hiding for pre-calculus text
div.book,
div.book > div.part {
  > div.preface,
  > div.chapter,
  > div.appendix {
    > div.section div.equation > *:last-child::after {
      display: none;
    }
  }
}

// Key Terms section counter adjustment. From Precalculus
// remove (-1) designation to make sure reset begins at 1.1 instead of 1.0
.x-duplicate-hierarchy() {
  > div.cnx-eoc { counter-reset: /*exercise*/ eoc-section; }
 }

// References
div.colophon.end-of-book-references .chapter-area {
  // Indentation of second line of reference requested by W&N along with no full justification on items
  .body .section-area {
    p {
      text-align: left;
      padding-left: 1.5em; 
      text-indent: -1.5em;
    }
  }

  .body .section-area .title {
    display: none; // Do not display section titles.
  }

  > .title {
    color: @black;
  }
}


// Answer Key
div.colophon.end-of-book-solutions div.chapter-area {
  div.solution {
    border: 1px solid green;
    padding-bottom: .2em;

    > div.title a.solution {
      padding-right: .2em;

      &::before {
        content: target-counter(attr(href), exercise) ".";
        display: inline-block;
      }  
    }

    &:nth-of-type(1) {
      padding-top: .5em;
    }

    > div.body {
      // lists must not be inline 
      li { display: list-item; }

      ol, ul { 
        border: 1px solid red;
      }

      // W&N requests that these ordered lists do not begin on a new line, but are displayed just
      // after the solution number.  This seems the only way to do this without adding extra divs
      // around the solution number.  Also, all other solutions (tables, figures, etc) have carriage
      // returns (vertical space) after the number before the solution begins.  It seems if we do
      // this styling to lists we should also do it for all possible answers, which will cause very
      // bad layout problems due to table size, wrapping, etc.  Leaving solution in place for now
      // The final decision might be to decide that this isn't a bug, but a new feature they want.
      // Extra code will need to be written for tables, figures if this is needed, and possibly
      // migrated to all books. 
      .orderedlist { 
        position: relative;
        display: inline-block;
        margin-top: -8px;
        margin-left: 15px;
      }
      
      /*
      * This is a bug-fix related to 
      *    display: inline;
      *    * { display: inline; }
      * being used in ccap-precalculus.less.
      */

      .table,
      table {
        display: table;
        caption { display: table-caption; }
        thead { display: table-header-group; }
        tbody { display: table-row-group; }
        tr { display: table-row; }
        td, th { display: table-cell; }
      }

      // Since up till now Answer Key has been just a blob of inline text, we must some how undo
      // the multitude of display:inline to allow the myriad new elements that are now a part of Answer Key.
      // Figures must be converted to block level elements and then
      // styled accordingly
      .figure { 
        // Stop outer container from collapsing
        display: block;
        margin-top: 1em;

        .title {
          border: 1px solid green;
          display: inline;
          text-align: left;
          // Can't remove period because "Figure " text is part of these selectors as well, so we will
          // display Figure text and counter using content to avoid a possible Docbook change to stop
          // the period generation being a part of Figure text.
          counter-increment: figure;
          content: "" "Figure " counter(chapter, decimal) "." counter(figure, decimal) " " "";
        }

        .caption:before {
          display: inline;
          margin-bottom: 0.25em;
          margin-top: 0.25em;
        }

        .caption {
          display: inline;
          text-align: center;
        }

        & img {
          max-width: ( @page-width - .25em ) !important;
          display: block;
          margin: 0 auto;
          border: 1px solid red;
        }
      }       
    }
  }

  // The target-exercise link-target class must be added to answer key to allow for correct numbering
  // when exercise link-targets are created.
  a.target-exercise {
    content: "" "Exercise " target-counter(attr(href), chapter) "." target-counter(attr(href), exercise) "" "";
  }
}





// Titles
.end-of-book-references,
.end-of-book-solutions {
  h1.title {
    color: @dark-blue;
  }

  // Must remove full justification of text from Answer Key entries
  text-align: left;
}
div.index div.title h2 {
  color: @dark-blue;
}












