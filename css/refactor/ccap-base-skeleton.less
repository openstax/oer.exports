// Copyright (c) 2013 Rice University
// This software is subject to the provisions of the GNU AFFERO GENERAL PUBLIC LICENSE Version 3.0 (AGPL).
// See LICENSE.txt for details.

@import url('utils.less');

// Usually Skeleton files would not contain styling information
// but rather would only tie slots to the dom. In the case of the
// base file there are many adhoc pieces of style that are defined here
// (sometimes for lack of a better home). Usually these apply to all
// elements of a given type, eg, all h1-h6, all ol/ul, etc.


// These two bits should be investigated further in order
// to find them a permanent home. They were a part of
// ccap-css3.css. These were moved here to not require
// content-slots.less in css3.less.
@namespace mml "http://www.w3.org/1998/Math/MathML";
mml|math { #content>#mathml>.style(); }

/* hides the table caption in caption to place at bottom of table */
div.table-caption.caption {
  display: none;
  string-set: caption-bottom content();
}



/***************************************************
 * Book Table of Contents
 ***************************************************/

.book > .toc {
  #part>#toc>.style();

  > .title {
    #part>#toc>#title>.style();
  }

  ul, li {
    list-style-type: none;
    padding-left: 0em;
    margin-left: 1em;
  }

  a {
    #part>#toc>#entry>.title(default);

    // Chapter 3 : Type Systems ........................ 213
    &::after { #part>#toc>#entry>.page(); }
  }

  > p {
    font-size: x-large;
    text-align: center;
  }

  > li > ul a { #part>#toc>#entry>.title(top); }

  // Hide TOC entries for sections in a  Preface or Appendix
  .toc-preface .toc-section  { #part>#toc>.show-sections-in(preface); }
  .toc-appendix .toc-section { #part>#toc>.show-sections-in(appendix); }

  .toc-chapter {
    > .target-chapter::before { display: none; } //remove number before chapter
    .cnx-gentext-chapter {
      display: inline;  // display as an inline-level element
      &.cnx-gentext-t { margin-left: .25em; }
    }
    // did not use the class selector .cnx-gentext-autogenerated bc two spans in the .target-chapter have the same class name
    span:nth-of-type(3) { prince-text-replace: "." ":"; }  // Chapter 1: The Study of Life
  }

  // TOC Section
  .toc-section {

    > a {
      #part>#toc>#entry>.title(section);
    }
    .cnx-gentext-section {
      display: inline;  // display as an inline-level element
      margin-left: .5em;
    }
    .cnx-gentext-autogenerated { display: none; } // removes '.' after section number
  }
}


// Hide sub-sections from the book, chapter, section level TOCs
.toc .toc-section .toc-section { #part>#toc>.show-sections-in(section); }

/***************************************************
 * PREFACE
 ***************************************************/

.preface {
  > .titlepage {
    h1.title { #part>#preface>#titlepage>.title(); }
  }

  > .section  {
    h2 {
      font-size: medium;
      > .cnx-gentext-t::before { display: none; } //hide pipe delimiter before section title
    }

    h3 {
      font-weight: bold;
      font-size: small;
    }
  }

  //preface: table without separators: hide table caption and table border
  .table {
    caption { display: none; }
    table { border-bottom: none !important; }  //override book specific rule
  }

  .figure > .title { display: none; } //preface: hide figure title

  ul > li { list-style-type: none; }
}


/***************************************************
 * CHAPTER INTRODUCTION
 ***************************************************/
 // titlepage: introduction banner - used for page headers
h1.title { //ccap-chapter
  #part>#title>.style(default);

  .cnx-gentext-autogenerated { display: none; } //The 1st span contains the chapter number

  .cnx-gentext-n { //ccap-chapter-number
    #part>#title>.number(default);
  }
}

.chapter  > .introduction {

  // hide manual key concepts table
  table.simplelist { display: none; }

  > .title { //.ccap-intro-title
    #part>#introduction>#title>.style(chapter);
  }

  .splash {
    img {
      #part>#introduction>#splash-figure>.image(chapter);
    }
  }

  > .toc {
    #part>#introduction>#chapter-outline>.style();

    > .title {
      #part>#introduction>#chapter-outline>#title>.style();
      #part>#introduction>#chapter-outline>#title>.content();
    }

    > * {
      #part>#introduction>#chapter-outline>.children();
      > li {
        #part>#introduction>#chapter-outline>#entry>.style();
      }
    }

    // TODO: Delete me. this is the same as #part>#toc>.children()
    > ul {
      padding-left: 0em;
      margin-left: 1em;
    }

    a {
      #part>#introduction>#chapter-outline>#entry>#title>.style();
    }
    .toc-section {
      .abstract { display: none; } //hide section-level abstract from objectives
      .cnx-gentext-autogenerated { display: none; }
      .cnx-gentext-t { #part>#introduction>#chapter-outline>#entry>.children-indent(); }
      .cnx-gentext-n {
        &::after { #part>#introduction>#chapter-outline>#entry>.d-section-colon(); } //add : after section #
        }
    }
    .abstract {
      #part>#introduction>#chapter-outline>#entry>#abstract>.style();
      ul {
        #part>#introduction>#chapter-outline>#entry>#abstract>.list();
        > li { #part>#introduction>#chapter-outline>#entry>#abstract>.list-item(); }
      }

    }
  }
}

/***************************************************
 * SECTION LEVEL LEARNING OBJECTIVES (section abstract)
 ***************************************************/
div.section > div.titlepage {
  div.abstract {
    #part>#chapter>#learning-objectives>.style();
    ul.itemizedlist {
      #part>#chapter>#learning-objectives>.list();
      > li { #part>#chapter>#learning-objectives>.list-item(); }
    }
  }
}

/* Squirrel away the collection URL so it shows up as the footer on every page */
#title_page_url a[href] {
  prince-text-replace: ":9680" "";  //this strips the port number
  string-set: cnx-collection-url attr(href);
}

/* Don't print module asterix (link to attribution) */
.section .titlepage, .introduction > .title, .appendix .titlepage {
  sup a { display: none; }
}

/* Hide the TOC for the Appendix */
.appendix .toc { display: none; }


/* Footnotes. remove margins */
.footnote {
  #content>#footnote>.style();
}

/********************** Generic Elements ********************/
body {
  font-size: 8.2pt;
  font-family: @font-family;
}

// BUGFIX: In princexml SVG in a table heading doesn't use the fonts set in the SVG
/* This NEEDS to be on its own line (can't do "body, th * { ...") */
th * { font-family: @font-family; }

a[href^="http"] { content: content() " (" attr(href) ") "; }

.chapter, .appendix, .colophon {
  #utils>#pb>.before(right);
  #utils>#pb>.after(left);
}

.equation {
  #content>#equation>.style();
}
.equation .label { #content>#equation>.label(); }

.figure { #content>#figure>.style(); }

.mathml-mi { font-family: Liberation Serif, serif, STIXGeneral, STIXSizeOneSym, STIXSize1; }

/**************************** Index **************************/
.book > .index {
  #index>.style();

  .index-term {
   #index>.term();
  }
}

.index .title * {
  #index>#title>.style();
}

.index .letter {
 #index>.letter();
}


.indexdiv, .indexdiv dl { #utils>#pb>.inside(auto); }

.indexterm[href] { content: target-counter(attr(href), page); }


/********************* Glossary Section **************/
#book.attribution, .colophon { font-size: x-small; }


/**************** Fix the PDF Outline *************/
h1 { bookmark-level: 1; #utils>#pb>.after(avoid); }
h2 { bookmark-level: 2; #utils>#pb>.after(avoid); }
h3, h4, h5, h6 { bookmark-level: none; #utils>#pb>.after(avoid); }


/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/
li p, dd p {
  margin-top: 0px;
  margin-bottom: 0px;
}

ol, ul { margin-top: 0px; }

dl { margin: 0.5em; }

// TODO: This needs to be removed as it produces three levels of settings
// for paragraph leading. Our indentation mixin, the default prince style and this
// Need to reduce to just one override, our mixin overridding prince default style
p { margin: 0.5em 0em; }

.table { #content>#table>.style(); }

.table td { #content>#table>.cell(); }

.table caption { #content>#table>.caption(); }


//Reset the table caption because I was dumb and didn't wrap the Table title in a span
div.table-caption {
  &.caption { display: inline; }
  font-weight: normal;
  color: black;
  display: inline;
  margin-left: 0.5em;
}

.table table { margin: 1.5em auto; }

.table th {
  #content>#table>.header();

  /* To fully support row/col spans in CALS tables borders are calculated for each cell and inherit the color of the text in the cell */
  /* By default the color in the PDF is the same color as the text so set it to black. */
  border-color: black !important;
}

div.table-caption.caption {
  caption-side: top;
  font-weight: bold;
}

.itemizedlist .title {
  margin: 0px;
  float: none;
  max-width: inherit;
}

/***************************************************************
 * Styles originally from physics but used in Sociology
 ***************************************************************/

/***************** Title page *****************/

.book > .cnx-title h1 {
  text-align: center;
  font-size: xx-large;
  margin-top: 10em;
}

.cnx-title a, #book-attribution a { content: content(); }

a { text-decoration: none; }

.problems-exercises img {
  max-width: 3in;
  height: auto;
}

/***************************************************************
 * Clean up padding and spacing
 ***************************************************************/
ol, ul { margin-left: 20pt; }

h2, h3, h4 { margin: 1em 0em 0em 0em; }

h2 { font-size: medium; }

h3 {
  font-size: 1.17em;
  font-weight: normal;
}

h4, h5, h6 { font-size: 1em; }

/**************** CNXML ELements ***********/
.note { //.ccap-note
  #content>#note>.style();
}

.note h3 { #content>#note>#title>.style(); }

.note > .title { #content>#note>.header(); }

.exercise { #content>#exercise>.style(); }

.example { #content>#example>.style(); }

.figure > .caption:before,
.figure > .title {
  display: inline;
  margin-bottom: 0.25em;
  margin-top: 0.25em;
}

.figure > .caption { display: inline; }

.figure > .body { text-align: center; }

/************** Generic Elements ************/
/* center the table */
table.cnx-figure-horizontal { margin: auto; }

table.cnx-figure-horizontal td img { max-width: 2in; }

table.cnx-figure-horizontal td img[height] { height: auto; }

img[height] { width: auto; }

img { max-width: 7in; }


/********************* Glossary Section **************/
// This is here for older books
.glossary {
  #part>#glossary>.style(chapter);
  .titlepage h2 { #part>#glossary>#title>.style(chapter); }
  dl {
    #part>#glossary>.style(chapter);
    dt {
      #part>#glossary>.term(chapter);
      &::after {
        #part>#glossary>.divider(chapter);
      }
    }
    dd { #part>#glossary>.definition(chapter); }
  }
}

em.glossterm {
  font-weight: bold;
  font-style: normal;
}

.glossterm.no-emphasis {
  font-weight: 400;
}

/******************************************************
 * End of chapter customizations
 ******************************************************/
.cnx-eoc {
  & > .title { #part>#chapter-end>#title>.style();  }
  .section {
    .title {
      #part>#chapter-end>#section>#title>.style();

      a {
        font-size: small;
        font-weight: bold;
      }
    }

    .problem {
      #utils>#pb>.inside(avoid);
    }
  }
}

.example > .title > *,
.cnx-eoc > .title > *,
.index > .title > *,
.glossary > .titlepage > div > div > * {
  //.ccap-block-title;
  //.ccap-block-title-link;
  padding: .1em 1em;
  margin-top: 1em;
  display: inline;

  font-size: small;
  font-weight: bold;
  #utils>#pb>.after(avoid);
}

// EOC Exercise fixes have not been refactored. These seem to be adhoc fixes due to Docbook.
// If these are going to be removed in the future then it's likely best to just keep
// them here.

/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * End-of-chapter exercises require a LOT of custom formatting
 * Moving from Docbook will fix this
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/* Exercises have the number in bold, followed by the 1st paragraph inline, not "Exercise 3 \n sldkfj" */

.cnx-eoc .exercise {

  /*** Exercises normally have more margins around them ***/
  margin-top: 0.5em;
  margin-bottom: 0.0em;

  div, p:first-of-type {
    display: initial;
  }

  div .figure {
    .body {
      display: block;
      text-align: center;
    }
    .title {
      //display: none;
    }
  }

  /* Hide the "Exercise " prefix */
  & > .title .cnx-gentext-autogenerated {
    display: none;
  }
  & > .title .cnx-gentext-n {
    font-weight: bold;
    font-size: 8.2pt;
    color: black;
  }
  & > .title {
    border-bottom: 0px;
  }

  /*** Make sure the default background colors for things like exercise body don't seep through ***/
  p, .body {
    background-color: inherit !important;
    padding: 0px !important;
  }


  .solution {
    display: none;
  }

  .problem > .title {
    font-weight: bold;
    margin-right: 0.5em;
  }

}

.exercise .solution::before {
  content: "Solution";
  font-weight: bold;
  display: block;
}

/***************************************************
 * Indentation
 ***************************************************/
.cnx-indentation-base;
