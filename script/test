#!/bin/bash

set -e
cd "$(dirname "$0")/.."

>&2 echo "==> Checking that we can fetch docbook-xsl from the XML catalog"
if [[ $(which brew) ]]; then
  declare -x XML_CATALOG_FILES=$(brew --prefix)/etc/xml/catalog
fi
xsltproc --catalogs --nonet ./docbook-xsl/xhtml-1_1/docbook.xsl ./test-ccap/m-anatomy/index_auto_generated.cnxml 2> /dev/null > /dev/null || exit 1


>&2 echo "==> Building a test book 'PDF'"
./script/build-pdf -d ./test-ccap/ -s ccap-physics -p ./script/_no-op-prince 2> /dev/null || exit 1

>&2 echo "==> Compiling CSS files"
./script/build-css > /dev/null || exit 1
